<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AP - Lista de Confirmados</title>

<style>
/* RESET */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
body { background:#f5f6fa; color:#333; transition:0.3s; font-size:16px; }

/* ----- NOVO MODO ESCURO SUAVE PREMIUM ----- */
body.dark { background:#181a1b; color:#e8e8e8; }

body.dark .header { background:#202324; }
body.dark .card { background:#242728; }
body.dark .card.present { background:#294f38; }

body.dark input { 
  background:#1e2021; 
  border:1px solid #444; 
  color:#eaeaea; 
}

/* MENU TOPO */
.header {
  position:sticky;
  top:0;
  background:#fff;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 20px;
  box-shadow:0 2px 8px rgba(0,0,0,0.05);
  z-index:1000;
}
.header h1 { font-size:1.4em; font-weight:bold; }

/* Botão modo escuro SUPER SUAVE */
#darkBtn {
  padding:8px 12px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  background: rgba(0,0,0,0.04);
  color:#222;
  transition:0.25s;
  font-size:14px;
  backdrop-filter: blur(4px);
}
#darkBtn:hover { background: rgba(0,0,0,0.12); }

/* DARK MODE BUTTON (suave, translúcido, moderno) */
body.dark #darkBtn {
  background: rgba(255,255,255,0.08);
  color:#f0f0f0;
}
body.dark #darkBtn:hover {
  background: rgba(255,255,255,0.14);
}

/* CONTAINER */
.container { max-width:600px; margin:20px auto; padding:0 12px 50px; }

/* CAMPOS */
.section { margin-top:15px; }

input[type=text], input[type=file], input[type=password] {
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:8px;
  font-size:16px;
  background:#fdfdfd;
}
input:focus {
  outline:none;
  border-color:#666;
}

/* BOTOES PRETOS (no modo claro) */
button.action-btn {
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  margin-top:10px;
  font-size:16px;
  cursor:pointer;
  font-weight:600;
  background:#000;
  color:white;
  transition:0.25s;
}
button.action-btn:hover { background:#2a2a2a; }

/* BOTOES NO MODO ESCURO — suaves e claros */
body.dark button.action-btn {
  background: rgba(255,255,255,0.16);
  color:#fff;
}
body.dark button.action-btn:hover {
  background: rgba(255,255,255,0.22);
}

/* CONTADOR */
#contador {
  text-align:center;
  font-weight:bold;
  padding:12px;
  margin:12px 0;
  border-radius:10px;
  background:#eaf0ff;
}
body.dark #contador {
  background:#222527;
  color:#ddd;
}

/* CARTÕES */
.card {
  background:#fff;
  padding:14px 16px;
  margin:8px 0;
  border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
  display:flex;
  justify-content:space-between;
  align-items:center;
  transition:0.3s;
}
.card.present {
  background:#c7f0d8;
}
.card.present .card-name {
  font-weight:700;
}

/* dark cards */
body.dark .card { background:#242728; }
body.dark .card.present { background:#294f38; }

/* Botão confirmar */
.card button {
  padding:8px 14px;
  font-size:14px;
  border-radius:8px;
  background:#000;
  color:white;
  font-weight:600;
  border:none;
  cursor:pointer;
  transition:0.25s;
}
.card button:hover { background:#333; }
.card button:disabled {
  background:#666;
  cursor:default;
}

/* botão confirmar no dark mode */
body.dark .card button {
  background: rgba(255,255,255,0.14);
  color:#fff;
}
body.dark .card button:hover {
  background: rgba(255,255,255,0.22);
}

/* ANIMAÇÃO */
.card.animar {
  animation: confirmarAnim 0.35s ease-out;
}
@keyframes confirmarAnim {
  0% { transform: scale(1); }
  50% { transform: scale(1.04); }
  100% { transform: scale(1); }
}

/* VOLTAR AO TOPO */
#btnTopo {
  position:fixed;
  bottom:18px;
  right:18px;
  padding:12px 16px;
  border:none;
  border-radius:50%;
  background:#888;
  color:white;
  font-size:18px;
  cursor:pointer;
  display:none;
  opacity:0.7;
}
#btnTopo:hover { background:#666; }

/* LOGIN */
#loginModal {
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.85);
  color:white;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
#loginModal input { max-width:300px; margin-top:10px; }
#loginModal button {
  max-width:180px;
  margin-top:12px;
  background:#000;
  color:white;
  border:none;
  padding:10px;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginModal">
  <h2>Digite a senha</h2>
  <input type="password" id="senhaInput" placeholder="Senha">
  <button onclick="verificarSenha()">Entrar</button>
</div>
&nbsp;&nbsp;&nbsp;AP - After Produções
<div class="header">
 <h1>Lista de Confirmados</h1>
  <button id="darkBtn" onclick="toggleDark()">Modo Escuro</button>
</div>

<div class="container">

  <div class="section">
    <input type="text" id="nome" placeholder="Digite o nome...">
    <button class="action-btn" onclick="addPessoa()">Adicionar Manualmente</button>
  </div>

  <div class="section">
    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls">
    <button class="action-btn" onclick="importarArquivo()">Importar Excel / CSV</button>
  </div>

  <div class="section">
    <input type="text" id="busca" oninput="filtrarTabela()" placeholder="Buscar nome...">
  </div>

  <div id="contador"></div>

  <div id="lista"></div>

</div>

<button id="btnTopo" onclick="voltarTopo()">↑</button>


<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
/* --- FIREBASE --- */
const firebaseConfig = {
  apiKey: "AIzaSyCW7fYPJcXkqVXYXyLUOkU-acnVyD9a6AI",
  authDomain: "ap-listadeconfirmados.firebaseapp.com",
  databaseURL: "https://ap-listadeconfirmados-default-rtdb.firebaseio.com",
  projectId: "ap-listadeconfirmados",
  storageBucket: "ap-listadeconfirmados.firebasestorage.app",
  messagingSenderId: "719499907860",
  appId: "1:719499907860:web:e5a522fce3c19f012801"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* LOGIN */
const SENHA="1234@@@";
const TEMPO_LOGIN=8*60*60*1000;

function verificarSenha(){
  const s=document.getElementById("senhaInput").value;
  if(s===SENHA){
    const agora=Date.now();
    localStorage.setItem("logado","1");
    localStorage.setItem("loginTime",agora);
    document.getElementById("loginModal").style.display="none";
  } else alert("Senha incorreta");
}

function checarLogin(){
  const log=localStorage.getItem("logado");
  const t=localStorage.getItem("loginTime");
  if(log==="1" && t){
    if(Date.now()-parseInt(t)>TEMPO_LOGIN){
      localStorage.clear();
      document.getElementById("loginModal").style.display="flex";
    } else {
      document.getElementById("loginModal").style.display="none";
    }
  }
}
checarLogin();

/* VARIÁVEIS */
let pessoas=[], nextId=1;

/* --- FIREBASE TEMPO REAL --- */
db.ref("pessoas").on("value", snap=>{
  const dados=snap.val();

  pessoas = dados ? Object.values(dados) : [];

  nextId = pessoas.length ? Math.max(...pessoas.map(x=>x.id))+1 : 1;

  atualizarLista();
  atualizarContador();
});

/* CONTADOR */
function atualizarContador(){
  const tot=pessoas.length;
  const pres=pessoas.filter(p=>p.presente).length;
  document.getElementById("contador").innerText=`Total: ${tot} | Presentes: ${pres}`;
}

/* EXIBE LISTA */
function atualizarLista(lista=null){
  const container=document.getElementById("lista");
  container.innerHTML="";

  const dados = lista || pessoas;

  dados.forEach(p=>{
    const card=document.createElement("div");
    card.className="card"+(p.presente?" present":"");

    card.innerHTML=`
      <div class="card-name">${p.nome}</div>
      <button onclick="confirmarPresenca(${p.id}, this)" ${p.presente?'disabled':''}>Confirmar</button>
    `;

    container.appendChild(card);
  });
}

/* ADICIONAR FINAL DA LISTA */
function addPessoa(){
  const nome=document.getElementById("nome").value.trim();
  if(!nome) return alert("Digite um nome");

  const pessoa={ id:nextId++, nome, presente:false };

  db.ref("pessoas/"+pessoa.id).set(pessoa);

  document.getElementById("nome").value="";
}

/* CONFIRMAR */
function confirmarPresenca(id, btn){
  const card=btn.parentElement;

  db.ref("pessoas/"+id+"/presente").set(true);

  btn.disabled=true;

  card.classList.add("present");
  card.classList.add("animar");
  setTimeout(()=>card.classList.remove("animar"),350);

  document.getElementById("busca").value="";
}

/* BUSCA */
function filtrarTabela(){
  const termo=document.getElementById("busca").value.toLowerCase();
  if(!termo) return atualizarLista();

  const filtrada = pessoas
    .filter(p=>p.nome.toLowerCase().includes(termo))
    .sort((a,b)=> a.nome.localeCompare(b.nome));

  atualizarLista(filtrada);
}

/* IMPORTAR */
function importarArquivo(){
  const arq=document.getElementById("fileInput").files[0];
  if(!arq) return alert("Escolha um arquivo");

  const reader=new FileReader();
  reader.onload=e=>{
    const wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
    const sheet=wb.SheetNames[0];
    const dados=XLSX.utils.sheet_to_json(wb.Sheets[sheet],{header:1});

    db.ref("pessoas").set(null);
    nextId=1;

    dados.forEach(l=>{
      if(!l||!l[0]) return;
      const nome=String(l[0]).trim();
      if(!nome || nome.toLowerCase().includes("nome")) return;

      const pessoa={id:nextId++, nome, presente:false};
      db.ref("pessoas/"+pessoa.id).set(pessoa);
    });

    alert("Importação concluída!");
  };
  reader.readAsArrayBuffer(arq);
}

/* DARK MODE */
function toggleDark(){ document.body.classList.toggle("dark"); }

/* TOPO */
function voltarTopo(){ window.scrollTo({top:0,behavior:"smooth"}); }
window.addEventListener("scroll",()=>{ 
  document.getElementById("btnTopo").style.display=window.scrollY>300?"block":"none";
});
</script>

</body>
</html>

