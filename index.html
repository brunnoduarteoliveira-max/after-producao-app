<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AP - Lista de Confirmados</title>

<style>
/* RESET */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
body { background:#f5f6fa; color:#333; transition:0.3s; font-size:16px; }

/* ----- MODO ESCURO NOVO PREMIUM ----- */
body.dark {
  background: #0d0d0d;
  color: #e9e9e9;
}

/* HEADER DARK */
body.dark .header {
  background: rgba(20,20,20,0.8);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255,255,255,0.07);
}

/* INPUTS */
body.dark input[type=text],
body.dark input[type=file],
body.dark input[type=password] {
  background: rgba(30,30,30,0.7);
  border: 1px solid rgba(255,255,255,0.08);
  color: #f1f1f1;
  backdrop-filter: blur(6px);
}
body.dark input:focus {
  border-color: #8ab4ff;
  background: rgba(40,40,40,0.9);
}

/* CARTÕES — vidro escuro */
body.dark .card {
  background: rgba(40,40,40,0.6);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 0 4px 12px rgba(0,0,0,0.35);
}

/* CARTÃO PRESENTE */
body.dark .card.present {
  background: rgba(45, 90, 55, 0.55);
  border: 1px solid rgba(120,255,120,0.1);
}

/* NOME EM NEGRITO NO PRESENTE */
.card.present .card-name {
  font-weight: 700;
}
body.dark .card.present .card-name {
  color: #d8ffd8;
}

/* ANIMAÇÃO AO CONFIRMAR */
.card.animar {
  animation: confirmarAnim 0.4s ease;
}
@keyframes confirmarAnim {
  0% { transform: scale(1); }
  50% { transform: scale(1.03); }
  100% { transform: scale(1); }
}

/* BOTÕES */
button.action-btn {
  width:100%; padding:12px; border:none; border-radius:12px; margin-top:10px;
  font-size:16px; cursor:pointer; font-weight:600;
  background:#000; color:white; transition:0.2s;
}
button.action-btn:hover { background:#333; }

body.dark .action-btn,
body.dark .card button {
  background:#111;
  color:#f0f0f0;
  border: 1px solid rgba(255,255,255,0.08);
}
body.dark .action-btn:hover,
body.dark .card button:hover {
  background:#1a1a1a;
}

/* Botões dentro do card */
.card button {
  padding:8px 14px; font-size:14px; border-radius:8px;
  background:#000; color:white; border:none; cursor:pointer;
}
.card button:hover { background:#333; }

/* HEADER */
.header { position:sticky; top:0; background:#fff; display:flex; justify-content:space-between;
  align-items:center; padding:12px 20px; box-shadow:0 2px 8px rgba(0,0,0,0.05); z-index:1000; }
.header h1 { font-size:1.4em; font-weight:bold; }

#darkBtn {
  padding:8px 12px; border:none; border-radius:10px; cursor:pointer;
  background: rgba(200, 200, 200, 0.2); color: #222; transition:0.2s; font-size:14px;
}
body.dark #darkBtn {
  background: rgba(255,255,255,0.08);
  color: #f9f9f9;
  border: 1px solid rgba(255,255,255,0.1);
}
body.dark #darkBtn:hover {
  background: rgba(255,255,255,0.18);
}

/* LISTA */
.container { max-width:600px; margin:20px auto; padding:0 10px 50px; }

.card {
  background:#fff; padding:12px 16px; margin:8px 0; border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05); display:flex; justify-content:space-between;
  align-items:center; transition:0.3s;
}

/* CONTADOR */
#contador {
  text-align:center;
  font-weight:bold;
  padding:12px;
  margin:12px 0;
  border-radius:10px;
  background:#f0f4ff;
}
body.dark #contador {
  background: rgba(30,30,30,0.6);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.06);
  color: #f1f1f1;
}

/* BOTÃO TOPO */
#btnTopo {
  position:fixed; bottom:18px; right:18px; padding:12px 16px; border:none;
  border-radius:50%; background:#888; color:white; font-size:18px;
  cursor:pointer; display:none; opacity:0.7; transition:0.2s;
}
body.dark #btnTopo {
  background: rgba(255,255,255,0.15);
}
body.dark #btnTopo:hover {
  background: rgba(255,255,255,0.22);
}

/* LOGIN */
#loginModal {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.85); color:white; display:flex;
  flex-direction:column; justify-content:center; align-items:center;
  z-index:9999;
}
body.dark #loginModal {
  background: rgba(0,0,0,0.9);
}

</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginModal">
  <h2>Digite a senha</h2>
  <input type="password" id="senhaInput" placeholder="Senha">
  <button onclick="verificarSenha()">Entrar</button>
</div>

<div class="header">
  <h1>Lista de Confirmados</h1>
  <button id="darkBtn" onclick="toggleDark()">Modo Escuro</button>
</div>

<div class="container">

  <input type="text" id="nome" placeholder="Digite o nome...">
  <button class="action-btn" onclick="addPessoa()">Adicionar Manualmente</button>

  <input type="file" id="fileInput" accept=".csv,.xlsx,.xls">
  <button class="action-btn" onclick="importarArquivo()">Importar Excel / CSV</button>

  <input type="text" id="busca" oninput="filtrarTabela()" placeholder="Buscar nome...">

  <div id="contador"></div>
  <div id="lista"></div>
</div>

<button id="btnTopo" onclick="voltarTopo()">↑</button>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
// FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCW7fYPJcXkqVXYXyLUOkU-acnVyD9a6AI",
  authDomain: "ap-listadeconfirmados.firebaseapp.com",
  databaseURL: "https://ap-listadeconfirmados-default-rtdb.firebaseio.com",
  projectId: "ap-listadeconfirmados",
  storageBucket: "ap-listadeconfirmados.firebasestorage.app",
  messagingSenderId: "719499907860",
  appId: "1:719499907860:web:e5a522fce3c19f012801"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// LOGIN
const SENHA="1234@@@";
const TEMPO_LOGIN = 8*60*60*1000;

function verificarSenha(){
  const s=document.getElementById("senhaInput").value;
  if(s===SENHA){
    localStorage.setItem("logado","1");
    localStorage.setItem("loginTime", new Date().getTime());
    document.getElementById("loginModal").style.display="none";
  } else {
    alert("Senha incorreta");
  }
}

function checarLogin(){
  const logado = localStorage.getItem("logado");
  const loginTime = localStorage.getItem("loginTime");
  if(logado==="1" && loginTime){
    if(new Date().getTime() - parseInt(loginTime) > TEMPO_LOGIN){
      localStorage.removeItem("logado");
      document.getElementById("loginModal").style.display="flex";
    } else {
      document.getElementById("loginModal").style.display="none";
    }
  }
}
checarLogin();

// VARIÁVEIS
let pessoas = [];
let nextId = 1;

// FIREBASE TEMPO REAL
db.ref("pessoas").on("value", snap=>{
  const dados = snap.val();
  pessoas = dados ? Object.values(dados) : [];
  nextId = pessoas.length ? Math.max(...pessoas.map(x=>x.id)) + 1 : 1;
  atualizarLista();
});

// ATUALIZA CONTADOR
function atualizarContador(){
  const total = pessoas.length;
  const presentes = pessoas.filter(p=>p.presente).length;
  document.getElementById("contador").innerText = `Total: ${total} | Presentes: ${presentes}`;
}

// ATUALIZA LISTA (NÃO ORDENA AO ADICIONAR MANUAL)
function atualizarLista(lista=null){
  const ordenar = !lista;
  const container = document.getElementById("lista");
  container.innerHTML = "";

  let dados = lista || [...pessoas];

  if(ordenar){
    dados.sort((a,b)=> a.nome.localeCompare(b.nome));
  }

  dados.forEach(p=>{
    const card=document.createElement("div");
    card.className = "card" + (p.presente ? " present" : "");
    card.innerHTML = `
      <div class="card-name">${p.nome}</div>
      <button onclick="confirmarPresenca(${p.id}, this)" ${p.presente?"disabled":""}>Confirmar</button>
    `;
    container.appendChild(card);
  });

  atualizarContador();
}

// ADICIONAR MANUALMENTE (ENVIA PRO FINAL)
function addPessoa(){
  const nome = document.getElementById("nome").value.trim();
  if(!nome) return alert("Digite um nome");

  const pessoa = { id: nextId++, nome, presente:false };
  pessoas.push(pessoa); // mantém no final localmente
  db.ref("pessoas/"+pessoa.id).set(pessoa);

  document.getElementById("nome").value = "";
  atualizarLista();
}

// CONFIRMAR PRESENÇA + ANIMAÇÃO
function confirmarPresenca(id, btn){
  const card = btn.parentElement;

  db.ref("pessoas/"+id+"/presente").set(true);

  btn.disabled = true;
  card.classList.add("present");

  card.classList.add("animar");
  setTimeout(()=> card.classList.remove("animar"), 400);

  document.getElementById("busca").value = "";
}

// FILTRO
function filtrarTabela(){
  const termo = document.getElementById("busca").value.toLowerCase();
  if(!termo) return atualizarLista();
  atualizarLista(pessoas.filter(p=>p.nome.toLowerCase().includes(termo)));
}

// IMPORTAR ARQUIVO
function importarArquivo(){
  const arq=document.getElementById("fileInput").files[0];
  if(!arq) return alert("Escolha um arquivo");

  const reader=new FileReader();
  reader.onload=e=>{
    const wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
    const sheet=wb.SheetNames[0];
    const dados=XLSX.utils.sheet_to_json(wb.Sheets[sheet],{header:1});

    db.ref("pessoas").set(null);
    pessoas = [];
    nextId = 1;
    let count = 0;

    dados.forEach(l=>{
      if(!l || !l[0]) return;
      const nome = String(l[0]).trim();
      if(!nome || nome.toLowerCase().includes("nome")) return;

      const pessoa = {id:nextId++, nome, presente:false};
      pessoas.push(pessoa);
      db.ref("pessoas/"+pessoa.id).set(pessoa);
      count++;
    });

    alert(count+" nomes importados!");
  };

  reader.readAsArrayBuffer(arq);
}

// DARK MODE
function toggleDark(){
  document.body.classList.toggle("dark");
}

// BOTÃO TOPO
function voltarTopo(){ window.scrollTo({top:0, behavior:"smooth"}); }
window.addEventListener("scroll",()=>{
  document.getElementById("btnTopo").style.display = window.scrollY>300 ? "block" : "none";
});
</script>
</body>
</html>
